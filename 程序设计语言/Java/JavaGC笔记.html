<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-09-23 周一 21:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Java GC学习笔记</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Java GC学习笔记</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0ed61f6">为什么要了解GC？</a></li>
<li><a href="#org75ed41b">Java中的GC算法</a>
<ul>
<li><a href="#orgca7d7fc">弱年代假设</a></li>
<li><a href="#orgd536c01">年轻代GC</a></li>
<li><a href="#orga4333eb">老年代GC</a></li>
<li><a href="#org0c92861">方法区</a></li>
<li><a href="#org85bda59">Serial收集器</a></li>
<li><a href="#orgd604b4e">ParNew收集器</a></li>
<li><a href="#orga32cfd3">Serial Old收集器</a></li>
<li><a href="#org72ae18d">Parallel Scavenge收集器</a></li>
<li><a href="#org2bb1807">Parallel GC（-XX:+UseParallelGC）</a></li>
<li><a href="#org5c8f5f0">Parallel Old GC（-XX:+UseParallelOldGC）</a></li>
<li><a href="#org38c6021">CMS GC（-XX:+UseConcMarkSweepGC）</a></li>
<li><a href="#orgb707ce9">G1（-XX:+UseG1GC）</a></li>
<li><a href="#org7da5a4e">ZGC（-XX:+UseZGC）</a></li>
</ul>
</li>
<li><a href="#org0baa9c0">GC参数选择</a></li>
<li><a href="#org5f3c7cb">GC问题分析</a></li>
<li><a href="#org5db47db">（待做）工具</a></li>
</ul>
</div>
</div>
<p>
解答以下问题：
</p>
<ul class="org-ul">
<li>为什么要了解GC？done</li>
<li>GC对程序的影响有哪些？done</li>
<li>Java中的GC算法有哪些？</li>
<li>如何选择合适的GC算法或参数？</li>
<li>如何判断是否是GC引起的程序性能问题？</li>
<li>如何定位是那部分对象使用不当引发GC问题？</li>
</ul>

<div id="outline-container-org0ed61f6" class="outline-2">
<h2 id="org0ed61f6">为什么要了解GC？</h2>
<div class="outline-text-2" id="text-org0ed61f6">
<p>
GC是垃圾回收（Garbage Collect）的英文缩写。“垃圾”指的是程序中不再使用的对象。程序运行中会使用大量的临时对象，如果不进行回收，内存很快会被耗尽，程序也无法继续执行。在C语言中，对象的释放需要开发者手动管理，而Java把这个工作会自动化了。垃圾收集的过程对程序是透明的，程序不需要知道垃圾收集是否进行，只需要关注业务逻辑。这看上去很完美，但是我们还要考虑另一个因素：时间。GC会暂停程序的执行，会让程序变慢。如果一个程序需要处理大量请求，同时频繁发生GC，或者GC持续时间很长，程序的响应时间就会变得很长，吞吐量大幅下降，直到系统不可用。为了避免这种情况的发生，我们必须了解GC。
</p>
</div>
</div>

<div id="outline-container-org75ed41b" class="outline-2">
<h2 id="org75ed41b">Java中的GC算法</h2>
<div class="outline-text-2" id="text-org75ed41b">
<p>
GC首先要找到哪些对象可以回收。线程堆栈中的本地对象还在使用，不能回收，全局引用对象也不能回收。这两类对象叫做GC根，GC根和GC根引用（包括间接引用）的对象都不能回收，其余对象则是不再使用的垃圾对象。找到垃圾对象的过程叫做可达性分析。找到垃圾对象之后就可以进行回收。回收之后，内存可能产生空洞，无法分配大对象，同时内存使用效率降低。为了处理内存空洞，一些GC算法还会进行压缩，将活跃对象移动到空洞中。这就是GC的三个步骤：标记、清理和压缩。所有的GC算法，都是采用这个基本的处理逻辑框架。
</p>



<p>
为了降低枚举GC根对应用线程产生的影响，Java引入了安全点（safe point）的概念，只有当线程执行到安全点时才进行GC。安全点的选择以“具有让程序长时间执行的特征”为原则，通常会选择方法调用、循环跳转、异常跳转等地方。 如果由于线程调度的原因（比如阻塞），某个线程一致无法执行到安全点，这会导致GC无法进行。针对这种情况，JVM对安全点进行了扩展，引入了安全区域（safe region）的概念。在安全区域中，对象的引用关系没有发生变更，可以安全的进行GC。应用线程进入安全区域时，为自己设置一个标志位。JVM发起GC时，可以不用阻塞在安全区域中运行的线程。但是当线程将要离开安全区域时，它必须等待直到确认系统已经完成了GC根的枚举。
</p>
</div>

<div id="outline-container-orgca7d7fc" class="outline-3">
<h3 id="orgca7d7fc">弱年代假设</h3>
<div class="outline-text-3" id="text-orgca7d7fc">
<p>
工程师在实践中发现对象大多服从下面的两条规律：
</p>

<ul class="org-ul">
<li>大部分对象很快变得不可达。</li>
<li>只有少量从旧对象中指向新对象的引用。</li>
</ul>

<p>
这两条规律叫做弱年代假设（Weak generational hypothesis）。基于这种假设，Java对新对象和老对象采用不同的回收机制，这样的垃圾收集器叫做分代垃圾收集器。
</p>


<p>
Java将内存分为年轻代和老年代。新建立的对象保存在年轻代中。这里的大部分对象很快变得不可达。而其他的对象，Java会把它们移动到老年代。老年代的空间更大，GC的频率更低。对老年代对象的清理叫做Major GC，年轻代的GC叫做Minor GC。
</p>

<p>
除了用户创建的对象，Java还要保存类的元数据、类的静态成员，以及常量字符串等等。这些对象保存在永久代（permanent generation，也叫方法区method area）中。区分Full GC和Major GC。
</p>
</div>
</div>


<div id="outline-container-orgd536c01" class="outline-3">
<h3 id="orgd536c01">年轻代GC</h3>
<div class="outline-text-3" id="text-orgd536c01">
<p>
年轻代分为三个区域：一个叫做伊甸园（eden），另外两个叫做幸存者空间（survivor）。新创建的对象保存在伊甸园中。当伊甸园GC完成后，幸存的对象被移动到一个特定的幸存者区域中。当这个幸存者区域饱和，Java会进行垃圾回收，并将幸存对象移动到另外一个幸存者区域中，然后清空这个幸存者区域。在幸存者区域中生存了一定时间的对象，会被移动到老年代。年轻代GC采用标记清除算法。年轻代中的对象可能被老年代对象引用。为了保证GC正确和高效，Java维护了一个卡片表（Card Table），记录了被老年代所引用的新生代对象。这种技术叫做point-out。
</p>
</div>
</div>

<div id="outline-container-orga4333eb" class="outline-3">
<h3 id="orga4333eb">老年代GC</h3>
<div class="outline-text-3" id="text-orga4333eb">
<p>
老年代GC对程序性能的影响较大。为此Java提供了多种GC类型供开发人员选择，以便充分发挥程序性能。这些GC类型包括
</p>

<ul class="org-ul">
<li>Serial GC</li>
<li>Parallel GC</li>
<li>Parallel Old GC（也叫做Parallel Compacting GC）</li>
<li>Concurrent Mark &amp; Sweep GC（简称CMS）</li>
<li>Garbage First GC（简称G1）</li>
</ul>
</div>
</div>


<div id="outline-container-org0c92861" class="outline-3">
<h3 id="org0c92861">方法区</h3>
<div class="outline-text-3" id="text-org0c92861">
<p>
方法区的空间也可能被回收。对于方法区中没有被引用的常量会被回收。如果一个类满足：
</p>
<ul class="org-ul">
<li>类的全部实例被回收。</li>
<li>类的ClassLoader被回收。</li>
<li>类的Class对象没有被引用。</li>
</ul>
<p>
它也会被回收。
</p>
</div>
</div>


<div id="outline-container-org85bda59" class="outline-3">
<h3 id="org85bda59">Serial收集器</h3>
<div class="outline-text-3" id="text-org85bda59">
<p>
Serial收集器是一个单线程的垃圾收集器，采用标记-清除-压缩（mark-sweep-compact）算法。Serial收集器在收集期间会暂停程序（STW），适用于桌面环境，或单CPU、内存较少的机器。使用参数-XX:+UseSerialGC可以开启Serial收集器。
</p>
</div>
</div>

<div id="outline-container-orgd604b4e" class="outline-3">
<h3 id="orgd604b4e">ParNew收集器</h3>
<div class="outline-text-3" id="text-orgd604b4e">
<p>
ParNew是Serial的多线程版本。对新生代对象，ParNew采用多线程、STW和复制的方式回收对象。对老年代对象，ParNew采用单线程、STW和标记-清理的方式回收。
</p>
</div>
</div>

<div id="outline-container-orga32cfd3" class="outline-3">
<h3 id="orga32cfd3">Serial Old收集器</h3>
<div class="outline-text-3" id="text-orga32cfd3">
<p>
Serial Old是Serial的老年代版本，采用标记-整理算法。
</p>
</div>
</div>

<div id="outline-container-org72ae18d" class="outline-3">
<h3 id="org72ae18d">Parallel Scavenge收集器</h3>
<div class="outline-text-3" id="text-org72ae18d">
<p>
Parallel Scavenge是新生代收集器，也是多线程、STW和复制的。Parallel Scavenge收集器会采用启发式算法，使得吞吐量（用户代码时间/(用户代码时间+GC时间)）尽量维持在用户期望（-XX:GCTimeRatio）的水平，或将GC停顿时间维持在用户期望（-XX:MaxGCPauseMillis）水平。
</p>
</div>
</div>

<div id="outline-container-org2bb1807" class="outline-3">
<h3 id="org2bb1807">Parallel GC（-XX:+UseParallelGC）</h3>
<div class="outline-text-3" id="text-org2bb1807">
<p>
Parallel GC使用多线程进行垃圾处理。相比Serial GC，Parallel GC的性能更好，需要的内存和CPU资源也更多。Parallel GC也叫做throughput GC。
</p>
</div>
</div>

<div id="outline-container-org5c8f5f0" class="outline-3">
<h3 id="org5c8f5f0">Parallel Old GC（-XX:+UseParallelOldGC）</h3>
<div class="outline-text-3" id="text-org5c8f5f0">
<p>
这种算法使用标记-整理-压缩（mark-summary-compact）算法。整理（summary）的过程比（sweep）更复杂。
</p>
</div>
</div>

<div id="outline-container-org38c6021" class="outline-3">
<h3 id="org38c6021">CMS GC（-XX:+UseConcMarkSweepGC）</h3>
<div class="outline-text-3" id="text-org38c6021">
<p>
这种算法的延迟比较低，但是对内存和CPU的要求较高。同时，如果程序中碎片过多，CMS算法产生的STW时间比其他算法更多。
</p>

<p>
CMS在Minor GC时会引发STW，而在Major GC时不会。
</p>
</div>
</div>

<div id="outline-container-orgb707ce9" class="outline-3">
<h3 id="orgb707ce9">G1（-XX:+UseG1GC）</h3>
<div class="outline-text-3" id="text-orgb707ce9">
<p>
G1也是分代垃圾回收器。不同的是，G1的新生代和老生代分布在多个区域（region）中。垃圾回收也是以区域为单位进行。此外，G1增加了一个叫做Humongous的区域来保存大对象（占分区容量50%以上的对象）。大对象之前默认保存在老生代中。同时G1把持久代改为元空间，保存在堆空间中。
</p>

<p>
G1提供了Young GC和Mix GC两种回收机制。Eden饱和会触发Young GC，将对象移动到Survivor。如果Survivor饱和，部分Eden对象会直接移动到老生代。为了处理老生代中的引用问题，G1使用了point-in技术，记录了哪些区域引用了本区域中的对象。
</p>


<p>
Mix GC回收新生代和老生代对象。Mix GC分为两个步骤
</p>

<ol class="org-ol">
<li>全局并发标记（global concurrent marking）</li>
<li>拷贝存货对象（evacuation）</li>
</ol>

<p>
在标记时，G1采用三色标记算法，将跟对象标记为黑色，将引用的对象标记为灰色，将不可达对象标记为白色。
</p>
</div>
</div>


<div id="outline-container-org7da5a4e" class="outline-3">
<h3 id="org7da5a4e">ZGC（-XX:+UseZGC）</h3>
<div class="outline-text-3" id="text-org7da5a4e">
<p>
ZGC也是基于区域和并发的垃圾回收算法。
</p>
</div>
</div>
</div>




<div id="outline-container-org0baa9c0" class="outline-2">
<h2 id="org0baa9c0">GC参数选择</h2>
</div>

<div id="outline-container-org5f3c7cb" class="outline-2">
<h2 id="org5f3c7cb">GC问题分析</h2>
</div>


<div id="outline-container-org5db47db" class="outline-2">
<h2 id="org5db47db">（待做）工具</h2>
<div class="outline-text-2" id="text-org5db47db">
<div class="org-src-container">
<pre class="src src-shell">jstat -gc $&lt;vmid&gt;$ 1000
jstat -gcutil
-verbosegc
-XX:+PrintGC
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintHeapAtGC
-Xloggc:D:\gc.log
-Xlog:gc
</pre>
</div>



<p>
DefNewGeneration有一个EdenSpace和两个ContiguousSpace。EdenSpace是ContiguousSpace的派生类，增加了soft_end。
Space是一个抽象的地址空间，其范围从bottom（含）到end（不含）。top在bottom和end之间，[top, end)是Space中空闲的空间。
</p>

<p>
d:/workspace/project/jdk11/hotspot/src/share/vm/memory/universe.cpp Universe::initialize_heap()根据参数选择GC。
对于SerialGC，会使用GenCollectedHeap(MarkSweepPolicy())作为Universe::_collectedHeap。
G1使用G1CollectedHeap。
ParallelGC使用ParallelScavengeHeap。
如果设置adaptiveSizePolicy，使用GenCollectedHeap(ASConcurrentMarkSweepPolicy())
否则使用GenCollectedHeap(ConcurrentMarkSweepPolicy())
这些policy定义在vm/memory/collectorPolicy.hpp中。
</p>

<p>
MarkSweepPolicy是一个TwoGenerationCollectorPolicy，它有2个Generation对象，
</p>

<p>
Generation是垃圾回收的代。在OpenJDK中， 最多支持10代。Serial使用2代。PermGen是持久代，在Collector中是独立的。Collector包含多个Generation和一个PermGen。Genertation[]数组和PermGen由CollectorPolicy的generations()和permanent_generation()返回的Spec通过方法init建立。对Serial，如果UseParNewGC且ParallelGCThreads&gt;0，gen[0]使用ParNew，否则使用DefNew。gen[1]使用MarkSweepCompact。ParNew使用ParNewGeneration，DefNew使用DefNewGeneration，MarkSweepCompact使用TenuredGeneration。
</p>

<p>
在do_collect之前，Collector首先要持有HeapLock。
</p>

<p>
ParNew和DefNew有什么不同？
Generation中的重要接口
promote()将对象提升到更老的代。
full_collects_younger_generations() 收集更年轻的低啊。
performs_in_place_marking() 标记
should_collect() 判断是否应该收集。
expand_and_allocate()
collect()
</p>

<p>
par_allocate
attempt_allocation
</p>

<p>
GenCollectorPolicy的分配流程如下：
如果可以在gen[0]中通过par_allocate()分配，直接分配，不加锁。
锁Heap_lock。
对于大对象（should_try_older_generation），尝试在老年代分配。
如果需要GC，且TLAB，返回NULL。
？？
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019年03月06日</p>
<p class="date">Created: 2019-09-23 周一 21:12</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
