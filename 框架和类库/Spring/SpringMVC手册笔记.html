<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-09-23 周一 21:00 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6a3a98b">DispatcherServlet</a></li>
<li><a href="#org18d3a8f">过滤器</a>
<ul>
<li><a href="#orgbf96760">Form Data</a></li>
</ul>
</li>
<li><a href="#orga2a48ac">注解控制器</a></li>
<li><a href="#orgb87fc5a">异步请求</a></li>
<li><a href="#orgba8a965">MVC配置</a></li>
</ul>
</div>
</div>
<p>
SpringMVC笔记
</p>


<p>
SpringMVC手册地址： <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc</a>
</p>

<p>
Spring提供了SpringMVC和Spring WebFlux（Spring5.0）作为Web开发框架。本章简单介绍一下SpringMVC。
</p>


<div id="outline-container-org6a3a98b" class="outline-2">
<h2 id="org6a3a98b">DispatcherServlet</h2>
<div class="outline-text-2" id="text-org6a3a98b">
<p>
SpringMVC使用一个前端控制器接收所有请求，并根据配置分派给对应的组件。这个中心控制器叫做DispatcherServlet。DispatcherServlet必须在web.xml中声明。下面的例子展示了DispatcherServlet的初始化和注册::
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyWebApplicationInitializer</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebApplicationInitializer</span> {
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">onStartup</span>(<span style="color: #228b22;">ServletContext</span> <span style="color: #a0522d;">servletContext</span>) {
        <span style="color: #228b22;">AnnotationConfigWebApplicationContext</span> <span style="color: #a0522d;">applicationContext</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">AnnotationConfigWebapplicationContext</span>();
        applicationContext.register(AppConfig.<span style="color: #a020f0;">class</span>);
        applicationContext.refresh();

        <span style="color: #228b22;">DispatcherServlet</span> <span style="color: #a0522d;">servlet</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DispatcherServlet</span>(applicationContext);
        <span style="color: #008b8b;">ServletRegistration</span>.<span style="color: #228b22;">Dynamic</span> <span style="color: #a0522d;">registration</span> = servletContext.addServlet(<span style="color: #8b2252;">"app"</span>, servlet);
        registration.setLoadOnStartup(1);
        registration.addMapping(<span style="color: #8b2252;">"/app/*"</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #0000ff;">web-app</span>&gt;
    &lt;<span style="color: #0000ff;">listener</span>&gt;
        &lt;<span style="color: #0000ff;">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;/<span style="color: #0000ff;">listener-class</span>&gt;
    &lt;/<span style="color: #0000ff;">listener</span>&gt;
    &lt;<span style="color: #0000ff;">context-param</span>&gt;
        &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
        &lt;<span style="color: #0000ff;">param-value</span>&gt;/WEB-INF/app-context.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
    &lt;/<span style="color: #0000ff;">context-param</span>&gt;
    &lt;<span style="color: #0000ff;">servlet</span>&gt;
        &lt;<span style="color: #0000ff;">servlet-name</span>&gt;app&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
        &lt;<span style="color: #0000ff;">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color: #0000ff;">servlet-class</span>&gt;
        &lt;<span style="color: #0000ff;">init-param</span>&gt;
            &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
            &lt;<span style="color: #0000ff;">param-value</span>&gt;&lt;/<span style="color: #0000ff;">param-value</span>&gt;
        &lt;/<span style="color: #0000ff;">init-param</span>&gt;
        &lt;<span style="color: #0000ff;">load-on-startup</span>&gt;1&lt;/<span style="color: #0000ff;">load-on-startup</span>&gt;
    &lt;/<span style="color: #0000ff;">servlet</span>&gt;
    &lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
        &lt;<span style="color: #0000ff;">servlet-name</span>&gt;app&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
        &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/app/*&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
    &lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;
&lt;/<span style="color: #0000ff;">web-app</span>&gt;
</pre>
</div>

<p>
DispatcherServlet需要使用WebApplicationContext进行初始化，后者绑定到ServletContext对象上。SpringMVC支持应用中存在多个WebApplicationContext。但是对于大部分应用，只需要一个WebApplicationContext就够了。DispatcherServlet委托Bean对象处理请求并渲染结果。Spring提供了一些内置的Bean对象：
</p>


<p>
HandlerMapping。将请求映射到处理函数，并调用相应的拦截器。HandlerMapping有两个主要的实现，一个是RequestMappingHandlerMapping，提供了@RequestMapping注解；另一个是SimpleUrlHandlerMapping。
HandlerAdapter。帮助DispatcherServlet调用处理函数。
HandlerExceptionResolver。处理异常。
ViewResolver。根据处理函数返回的视图名寻找视图对象。
LocaleResolver, LocaleContextResolver。处理本地化。
ThemeResolver。处理主题。
MultipartResolver。处理multi-part请求。
FlashMapManager。处理请求之间传递属性的FlashMap。
</p>


<p>
从Servlet 3.0开始，你可以使用程序代码进行Servlet容器的配置，下面的示例注册DispatcherServlet实例：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">import</span> <span style="color: #008b8b;">org</span>.<span style="color: #008b8b;">springframework</span>.<span style="color: #008b8b;">web</span>.<span style="color: #228b22;">WebApplicationInitializer</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyWebApplicationInitializer</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebApplicationInitializer</span> {
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">onStartup</span>(<span style="color: #228b22;">ServletContext</span> <span style="color: #a0522d;">container</span>) {
        <span style="color: #228b22;">XmlWebApplicationContext</span> <span style="color: #a0522d;">applicationContext</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">XmlWebApplicationContext</span>();
        applicationContext.setConfigLocation(<span style="color: #8b2252;">"/WEB-INF/spring/dispatcher-config.xml"</span>);
        <span style="color: #008b8b;">ServletRegistration</span>.<span style="color: #228b22;">Dynamic</span> <span style="color: #a0522d;">registration</span> = container.addServlet(<span style="color: #8b2252;">"dispatcher"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DispatcherServlet</span>(applicationContext));
        registration.setLoadOnStartup(1);
        registration.addMapping(<span style="color: #8b2252;">"/"</span>);
    }
}
</pre>
</div>

<p>
WebApplicationInitializer可以被Spring自动检测和加载，以进行容器初始化。如果使用AbstractDispatcherServletInitializer，可以变得更简单：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyWebAppInitializer</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">AbstractAnnotationConfigDispatcherServletInitializer</span> {
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">Class</span>&lt;?&gt;[] <span style="color: #0000ff;">getRootConfigClasses</span>() { <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>; }
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">Class</span>&lt;?&gt;[] <span style="color: #0000ff;">getServletConfigClasses</span>() {
         <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Class</span>&lt;?&gt;[] { MyWebConfig.<span style="color: #a020f0;">class</span> };
    }
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">String</span>[] <span style="color: #0000ff;">getServletMappings</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">String</span>[] { <span style="color: #8b2252;">"/"</span> };
    }
}
</pre>
</div>

<p>
AbstractDispatcherServletInitializer也提供了简化过滤器的方法：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Override</span>
<span style="color: #a020f0;">protected</span> <span style="color: #228b22;">Filter</span>[] <span style="color: #0000ff;">getServletFilters</span>() {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>


<p>
DispatcherServlet处理请求的流程如下：
</p>

<ul class="org-ul">
<li>寻找WebApplicationContext对象，作为属性绑定到请求对象上。属性名为DispatcherServlet.WEB<sub>APPLICATION</sub><sub>CONTEXT</sub><sub>ATTRIBUTE</sub>。</li>

<li>为请求绑定本地化解析程序。</li>

<li>为请求绑定主题解析程序。</li>

<li>如果设置了multipart文件解析程序，且请求包含multipart信息，将请求封装为MultipartHttpServletRequest对象。</li>

<li>找到合适的处理程序，处理请求。</li>

<li>如果返回模型（model），渲染对应视图（view）。</li>
</ul>

<p>
WebApplicationContext中声明的HandlerExceptionResolver用来解决请求处理中发生的异常。DispatcherServlet是可配置的，通过传入初始化参数可以做到这一点：
</p>

<p>
contextClass。一个ConfigurableWebApplicationContext实例，默认使用XmlWebApplicationContext。
contextConfigLocation。传递给contextClass对象的字符串，告诉contextClass从哪里加载配置文件。
namespace。WebApplicationContext的名字空间，默认为[servlet名字]-servlet。
throwExceptionIfNoHandlerFound。默认是false。
</p>

<p>
所有的HandlerMapping实现都支持拦截。拦截器必须实现org.springframework.web.servlet.HandlerInterceptor接口。拦截器有3个方法：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #228b22;">void</span> <span style="color: #0000ff;">afterCompletion</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span>);
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">postHandle</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">modelAndView</span>);
<span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">preHandle</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>);
</pre>
</div>

<p>
如果preHandle返回false，DispatcherServlet认为拦截器已经完成了对请求对处理，不会继续转发给后续的连接器或处理函数。
</p>

<p>
在处理过程中发生的异常会委托给一系列HandlerExceptionResolver处理。Spring提供的HandlerExceptionResolver有：
</p>

<p>
SimpleMappingExceptionResolver。将异常映射为视图名。
DefaultHandlerExceptionResolver。将异常映射为HTTP状态码。
ResponseStatusExceptionResolver。
ExceptionHandlerExceptionResolver。
</p>

<p>
Spring MVC定义了ViewResolver和View接口来渲染模型。ViewResolver将视图名映射为View对象。
</p>

<p>
AbstractCachingViewResolver。
XmlViewResolver。
ResourceBundleViewResolver。
UrlBasedViewResolver。
InternalResourceViewResolver。
FreeMarkerViewResolver。
ContentNegotiatingViewResolver。
</p>

<p>
如果要调整Spring MVC的日志级别，可以在初始化时候设置参数：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyInitializer</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">AbstractAnnotationConfigDispatcherServletInitializer</span> {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">customizeRegistration</span>(<span style="color: #228b22;">Dynamic</span> <span style="color: #a0522d;">registration</span>) {
        regisration.setInitParameter(<span style="color: #8b2252;">"enableLoggingRequestDetails"</span>, <span style="color: #8b2252;">"true"</span>);
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org18d3a8f" class="outline-2">
<h2 id="org18d3a8f">过滤器</h2>
<div class="outline-text-2" id="text-org18d3a8f">
<p>
spring-web模块提供了一下的过滤器
</p>

<p>
Form Data
Forwarded Headers
Shallow ETag
CORS
</p>
</div>

<div id="outline-container-orgbf96760" class="outline-3">
<h3 id="orgbf96760">Form Data</h3>
<div class="outline-text-3" id="text-orgbf96760">
<p>
spring-web模块提供了FormContentFilter来处理application/x-www-form-urlencoded类型的PUT、PATCH和DELETE请求。
</p>
</div>
</div>
</div>

<div id="outline-container-orga2a48ac" class="outline-2">
<h2 id="orga2a48ac">注解控制器</h2>
<div class="outline-text-2" id="text-orga2a48ac">
<p>
Spring MVC提供了注解@Controller和@RestController来声明控制器。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HelloController</span> {
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/hello"</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">handle</span>(<span style="color: #228b22;">Model</span> <span style="color: #a0522d;">model</span>) {
        model.addAttribute(<span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Hello, World!"</span>);
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"index"</span>;
    }
}
</pre>
</div>

<p>
注解需要进行扫描
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Configuration</span>
<span style="color: #008b8b;">@ComponentScan</span>(<span style="color: #8b2252;">"org.example.web"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">WebConfig</span> {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #8b2252;">&lt;?</span><span style="color: #a020f0;">xml</span><span style="color: #8b2252;"> </span><span style="color: #8b2252;">version="1.0" encoding="UTF-8"</span><span style="color: #8b2252;">?&gt;</span>
&lt;<span style="color: #0000ff;">beans</span> <span style="color: #483d8b;">xmlns</span>=<span style="color: #8b2252;">"http://www.springframework.org/schema/beans"</span>
    <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">xsi</span>=<span style="color: #8b2252;">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">p</span>=<span style="color: #8b2252;">"http://www.springframework.org/schema/p"</span>
    <span style="color: #483d8b;">xmlns</span>:<span style="color: #a0522d;">context</span>=<span style="color: #8b2252;">"http://www.springframework.org/schema/context"</span>
    <span style="color: #483d8b;">xsi</span>:<span style="color: #a0522d;">schemaLocation</span>=<span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">        http://www.springframework.org/schema/beans</span>
<span style="color: #8b2252;">        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span style="color: #8b2252;">        http://www.springframework.org/schema/context</span>
<span style="color: #8b2252;">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;

    &lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"org.example.web"</span>/&gt;

    <span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">... </span><span style="color: #b22222;">--&gt;</span>

&lt;/<span style="color: #0000ff;">beans</span>&gt;
</pre>
</div>

<p>
@RestController是@Controller和@ResponseBody的简写形式。
</p>

<p>
注解@RequestMapping将请求映射到控制器方法。@RequestMapping有几个特化形式
</p>

<p>
@GetMapping
@PostMapping
@PutMapping
@DeleteMapping
@PatchMapping
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@RestController</span>
<span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/persons"</span>)
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PersonController</span> {
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/{id}"</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Person</span> <span style="color: #0000ff;">getPerson</span>(<span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">id</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }

    <span style="color: #008b8b;">@PostMapping</span>
    <span style="color: #008b8b;">@ResponseStatus</span>(<span style="color: #008b8b;">HttpStatus</span>.<span style="color: #228b22;">CREATED</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">add</span>(<span style="color: #008b8b;">@ResponseBody</span> <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">person</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/owners/{ownerId}/pets/{petId}"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">Pet</span> <span style="color: #0000ff;">findPet</span>(<span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">ownerId</span>, <span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">petId</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}

<span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/owners/{ownerId}"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">OwnerController</span> {
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/pets/{petId}"</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Pet</span> <span style="color: #0000ff;">findPet</span>(<span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">ownerId</span>, <span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">petId</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }
}
</pre>
</div>

<p>
控制方法参数
</p>

<p>
WebRequest, NativeWebRequest
javax.servlet.ServletRequest, javax.servlet.ServletResponse
javax.servlet.http.HttpSession
javax.servlet.http.PushBuilder
java.security.Principal
HttpMethod
java.util.Locale
java.util.TimeZone, java.time.ZoneId
java.io.InputStream, java.io.Reader
java.io.OutputStream, java.io.Writer
@PathVariable
@MatrixVariable
@RequestParam
@RequestHeader
@CookieValue
@RequestBody
HttpEntity&lt;B&gt;
@RequestPart
java.util.Map, org.springframework.ui.Model, org.springframework.ui.ModelMap
RedirectAttributes
@ModelAttribute
Errors, BindingResult
SessionStatus + class-level @SessionAttributes
UriComponentsBuilder
@SessionAttribute
@RequestAttribute
Any other argument
</p>

<p>
控制方法的返回值可以是
</p>

<p>
@ResponseBody 通过HttpMessageConverter转换返回值。
HttpEntity&lt;B&gt;, ResponseEntity&lt;B&gt;
HttpHeaders
String 视图名。
View 视图对象。
java.util.Map, org.springframework.ui.Model
@ModelAttribute
ModelAndView
void
DeferredResult&lt;V&gt; 异步结果。
Callable&lt;V&gt; 异步。
ListenableFuture&lt;V&gt;, java.util.concurrent.CompletionStage&lt;V&gt;, java.util.concurrent.CompletableFuture&lt;V&gt;
ResponseBodyEmitter, SseEmitter
StreamingResponseBody
Reactive types
Any other return value
</p>

<p>
通过@RequestHeader可以绑定HTTP头数据：
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/demo"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">handle</span>(<span style="color: #008b8b;">@RequestHeader</span>(<span style="color: #8b2252;">"Accept-Encoding"</span>) <span style="color: #228b22;">String</span> <span style="color: #a0522d;">encoding</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>

<p>
@CookieValue可以得到cookie：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/demo"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">handle</span>(<span style="color: #008b8b;">@CookieValue</span>(<span style="color: #8b2252;">"foo"</span>) <span style="color: #228b22;">String</span> <span style="color: #a0522d;">cookie</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>


<p>
@RequestBody注解可以将请求内容通过HttpMessageConverter反序列化为Java对象：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@PostMapping</span>(<span style="color: #8b2252;">"/accounts"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">handle</span>(<span style="color: #008b8b;">@RequestBody</span> <span style="color: #228b22;">Account</span> <span style="color: #a0522d;">account</span>) {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>

<p>
@ResponseBody可以通过HttpMessageConverter将返回对象进行序列化：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/accounts/{id}"</span>)
<span style="color: #008b8b;">@ResponseBody</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">Account</span> <span style="color: #0000ff;">handle</span>() {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
}
</pre>
</div>

<p>
ResponseEntity和@ResponseBody类似：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/something"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">ResponseEntity</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #0000ff;">handle</span>() {
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">body</span> = ...;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">etag</span> = ...;
    <span style="color: #a020f0;">return</span> ResponseEntity.ok().eTag(etag).build(body);
}
</pre>
</div>

<p>
Spring提供了Jackson序列化视图：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@RestController</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserController</span> {
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/user"</span>)
    <span style="color: #008b8b;">@JsonView</span>(<span style="color: #008b8b;">User</span>.WithoutPasswordView.<span style="color: #a020f0;">class</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">User</span> <span style="color: #0000ff;">getUser</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">User</span>(<span style="color: #8b2252;">"eric"</span>, <span style="color: #8b2252;">"7!jd#h23"</span>);
    }
}

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> {
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">WithoutPasswordView</span> {};
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">WithPasswordView</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">WithoutPasswordView</span> {};

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">User</span>() {}

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">User</span>(<span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>) {
        <span style="color: #a020f0;">this</span>.username = username;
        <span style="color: #a020f0;">this</span>.password = password;
    }

    <span style="color: #008b8b;">@JsonView</span>(WithoutPasswordView.<span style="color: #a020f0;">class</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getUsername</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">this</span>.username;
    }

    <span style="color: #008b8b;">@JsonView</span>(WithPasswordView.<span style="color: #a020f0;">class</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getPassword</span>() {
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">this</span>.password;
    }
}
</pre>
</div>


<p>
@Controller类可以有@ExceptionHandler方法来处理异常：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleController</span> {
    <span style="color: #008b8b;">@ExceptionHandler</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ResponseEntity</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #0000ff;">handle</span>(<span style="color: #228b22;">IOException</span> <span style="color: #a0522d;">e</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }

    <span style="color: #008b8b;">@ExceptionHandler</span>({FileSystemException.<span style="color: #a020f0;">class</span>, RemoteException.<span style="color: #a020f0;">class</span>})
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ResponseEntity</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #0000ff;">handle</span>(<span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb87fc5a" class="outline-2">
<h2 id="orgb87fc5a">异步请求</h2>
<div class="outline-text-2" id="text-orgb87fc5a">
<p>
在启用异步请求后，可以让控制方法返回DeferredResult对象来实现异步处理：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/quotes"</span>)
<span style="color: #008b8b;">@ResponseBody</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">DeferredResult</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #0000ff;">quotes</span>() {
    <span style="color: #228b22;">DeferredResult</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #a0522d;">deferredResult</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DeferredResult</span>&lt;<span style="color: #228b22;">String</span>&gt;();
    <span style="color: #a020f0;">return</span> deferredResult;
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#20854;&#20182;&#32447;&#31243;&#20013;&#65306;</span>
deferredResult.setResult(data);
</pre>
</div>

<p>
也可以将返回的结果封装到java.util.concurrent.Callable中：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@PostMapping</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">Callable</span>&lt;<span style="color: #228b22;">String</span>&gt; <span style="color: #0000ff;">processUpload</span>(<span style="color: #a020f0;">final</span> <span style="color: #228b22;">MultipartFile</span> <span style="color: #a0522d;">file</span>) {
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Callable</span>&lt;<span style="color: #228b22;">String</span>&gt;() {
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">call</span>() <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> {
            <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
            <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"someView"</span>;
        }
    };
}
</pre>
</div>

<p>
Servlet对异步请求的处理方式如下：
</p>

<ul class="org-ul">
<li>调用ServletRequest.startAsync()，将请求设置为异步模式。</li>
<li>startAysnc()返回一个AsnycContext对象，用于异步处理请求。</li>
<li>ServletRequest提供了DispatcherType，据此可以判断请求类型。</li>
</ul>

<p>
DeferredResult的处理过程如下：
</p>

<ul class="org-ul">
<li>控制器返回DeferredResult，并将其放置在队列中。</li>
<li>Spring MVC调用request.startAsync()。</li>
<li>DispatcherServlet和过滤器退出请求处理线程，保持请求开放。</li>
<li>应用在其他线程中设置DeferredResult。Spring MVC将请求分派回Servlet容器。</li>
<li>DispatcherServlet被再次调用，处理异步结果并返回。</li>
</ul>

<p>
Callable的处理过程是：
</p>

<ul class="org-ul">
<li>控制器返回Callable。</li>
<li>Spring MVC调用request.startAsync()，提交Callable给TaskExecutor，在独立的线程中处理。</li>
<li>同时，DispatcherServlet和过滤器退出Servlet容器线程，保持请求开放。</li>
<li>最终Callable产生一个结果，Spring MVC分派请求回Servlet容器以完成处理。</li>
<li>DispatcherServlet被再次调用，处理异步结果。</li>
</ul>

<p>
如果异步处理时发生异常，可以调用DeferredResult.setErrorResult()方法。异步拦截器由AsyncHandlerInterceptor定义。
</p>

<p>
Spring MVC也提供了对HTTP流的支持：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/events"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">ResponseBodyEmitter</span> <span style="color: #0000ff;">handle</span>() {
    <span style="color: #228b22;">ResponseBodyEmitter</span> <span style="color: #a0522d;">emitter</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ResponseBodyEmitter</span>();
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;emitter</span>
    <span style="color: #a020f0;">return</span> emitter;
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#20854;&#20182;&#32447;&#31243;</span>
emitter.send(<span style="color: #8b2252;">"Hello once"</span>);
emitter.send(<span style="color: #8b2252;">"Hello again"</span>);
emitter.complete();

</pre>
</div>

<p>
Spring MVC也支持Server-Side Events（SSE）：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@GetMapping</span>(path=<span style="color: #8b2252;">"/events"</span>, produces=<span style="color: #008b8b;">MediaType</span>.TEXT_EVENT_STREAM_VALUE)
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">SseEmitter</span> <span style="color: #0000ff;">handle</span>() {
    <span style="color: #228b22;">SseEmitter</span> <span style="color: #a0522d;">emitter</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SseEmitter</span>();
    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    <span style="color: #a020f0;">return</span> emitter;
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#20854;&#20182;&#32447;&#31243;</span>
emitter.send(<span style="color: #8b2252;">"Hello once"</span>);
emitter.send(<span style="color: #8b2252;">"Hello again"</span>);
emitter.complete();

</pre>
</div>

<p>
异步处理必须在Servlet级别进行配置。在Spring MVC中，可以使用WebMvcConfigurer的configureAsyncSupport回调，或在xml的&lt;mvc:annotation-driven&gt;中增加&lt;async-support&gt;标签。
</p>


<p>
控制方法支持CORS：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@RestController</span>
<span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/account"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AccountController</span> {
    <span style="color: #008b8b;">@CrossOrigin</span>
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/{id}"</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Account</span> <span style="color: #0000ff;">retrieve</span>(<span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">id</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }
}

<span style="color: #008b8b;">@CrossOrigin</span>(origins = <span style="color: #8b2252;">"http://domain2.com"</span>, maxAge = 3600)
<span style="color: #008b8b;">@RestController</span>
<span style="color: #008b8b;">@RequestMapping</span>(<span style="color: #8b2252;">"/account"</span>)
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AccountController</span> {
    <span style="color: #008b8b;">@GetMapping</span>(<span style="color: #8b2252;">"/{id}"</span>)
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Account</span> <span style="color: #0000ff;">retrieve</span>(<span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">Long</span> <span style="color: #a0522d;">id</span>) {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
    }
}
</pre>
</div>

<p>
也可以对CORS进行全局配置：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Configuration</span>
<span style="color: #008b8b;">@EnableWebMvc</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">WebConfig</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebMvcConfigurer</span> {
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">addCorsMappings</span>(<span style="color: #228b22;">CorsRegistry</span> <span style="color: #a0522d;">registry</span>) {
        registry.addMapping(<span style="color: #8b2252;">"/api/**"</span>)
            .allowedOrigins(<span style="color: #8b2252;">"http://domain2.com"</span>)
            .allowedMethods(<span style="color: #8b2252;">"PUT"</span>, <span style="color: #8b2252;">"DELETE"</span>)
            .allowedHeaders(<span style="color: #8b2252;">"header1"</span>, <span style="color: #8b2252;">"header2"</span>)
            .allowCredentials(<span style="color: #008b8b;">true</span>)
            .maxAge(3600);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba8a965" class="outline-2">
<h2 id="orgba8a965">MVC配置</h2>
<div class="outline-text-2" id="text-orgba8a965">
<p>
使用注解@EnableWebMvc可以自定义MVC配置：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Configuration</span>
<span style="color: #008b8b;">@EnableWebMvc</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">WebConfig</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebMvcConfigurer</span> {
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2019-09-23 周一 21:00</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
