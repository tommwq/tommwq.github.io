<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-09-23 周一 21:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<p>
2016年年度总结
</p>

<p>
一、工作总结
</p>

<p>
1、 手机金太阳行情新功能开发和优化。
</p>

<p>
1.1 股转系统分层功能的测试、升级、部署和维护，增加股转分层功能，对交易所新业务提供支持。
</p>

<p>
1.2 深交所新一代交易系统行情测试、升级、部署和维护，将行情系统接入深交所新一代交易系统。
</p>

<p>
1.3 新版金太阳行情后台功能评审、设计和开发。包括对原有接口的改造和新接口设计、开发。
</p>

<p>
1.4 深港通行情功能开发。
</p>

<p>
1.5 港股实时行情、美股实时行情功能测试、开发和部署方案设计。
</p>

<p>
1.6 升级Convert脚本。增加更新行情系统中基金份额数据的功能。
</p>

<p>
2 新版行情系统设计和开发。
</p>

<p>
2.1 目标是为电商部多个app提供一套灵活高效、稳定可靠的通用行情数据服务。现有行情系统稳定性有严重隐患，功能不足，远远落后市场同类产品，无法为用户提供有价值的行情服务。
</p>

<p>
2.2 已经完成初步架构设计。从业务扩展性、稳定性、性能、高可用等方面入手设计行情系统，已经评审过一次，也同运维同事进行了沟通。
</p>

<p>
2.3 调研鑫投顾、凌志、通达信、伊诺行情系统。
</p>


<p>
3 升级股票预警
</p>

<p>
3.1 行情预警功能优化。为基金类证券提供更精确的预警信息。
</p>

<p>
3.2 协助杜恒升级老推送系统，将行情预警系统接入统一用户系统。
</p>


<p>
4 新版金太阳的开发工作
</p>

<p>
4.1 开发新版金太阳自选股接口。
</p>

<p>
4.2 开发自选基金和基金搜索接口，整合Zbus和TC。
</p>

<p>
4.3 开发AH股功能。
</p>

<p>
4.4 开发股票搜索功能。
</p>

<p>
4.5 开发指数分类功能。
</p>

<p>
5 手机金太阳资讯新功能开发和优化。
</p>

<p>
5.1 首页今日焦点改版升级。负责后台接口开发、测试、部署以及相关的协调沟通工作。
</p>

<p>
5.2 WebF10功能优化升级。对WebF10一些功能进行优化，负责开发（后台接口、js）、测试、部署以及相关的协调沟通工作。
</p>

<p>
5.3 WebF10程序稳定性优化。对数据库和程序进行优化，提高响应时间，提升用户体验。
</p>

<p>
5.4 对WebF10数据库结构进行升级，以适配资讯商数据源变更。
</p>

<p>
5.5 优化WebF10程序，将数据库CPU使用率从80%降到3%左右。
</p>


<p>
6 保障系统稳定运行。
</p>

<p>
6.1 资讯系统问题（程序运行问题、数据准确性问题）的排查和处理。处理了数据同步异常、数据提取规则不一致等各种问题，和机房、资讯中心一起建立了多数据源比对机制，提供数据源质量。
</p>

<p>
6.2 行情系统问题（程序运行问题、数据准确性问题）的排查和处理。处理行情源故障、EDB数据库故障、程序BUG等各种问题，针对新发现的问题编写监控程序，完善监控机制。和机房一起设计故障处理预案，保障行情服务稳定、可靠。
</p>

<p>
6.3 ProcMO升级和维护。ProcMO是遗留的V1系统，将ProcMO升级到V4系统，并提供维护支持。节省服务器资源和运维资源，提高系统整理稳定性。
</p>

<p>
6.4 为金融矿工和股单提供行情系统技术支持和维护，开发专用接口和程序。
</p>

<p>
7 深港通行情升级
</p>

<p>
8 港股实时行情升级
</p>

<p>
二、反思和改进
</p>

<p>
1、行情EDB频繁出现故障。
</p>

<p>
今年EDB出现过好几次故障，有导入数据异常造成崩溃的，有自动扩盘造成崩溃的，也有执行查询语句导致崩溃的情况。机房在部署EDB时，以15年请求量峰值为基准，并增加了裕度，一共部署了28台EDB，比之前部署规模扩大不少。在EDB稳定性没有彻底解决的情况下，部署规模的增加的同时，故障次数也增加了。而且EDB崩溃后的恢复操作复杂，故障修复时间长，加上行情服务最受用户关注，有几次故障的影响范围比较大。
</p>

<p>
为了改善EDB的稳定性，我们和伊诺的毛总进行过多次沟通，包括请毛总到机房一起分析排查。毛总给了一个去除多余索引的方案。这个方案已经实施，对EDB性能有所提升，但对稳定性的改善有限。为了提高EDB的稳定性，我和机房也准备了几套方案，包括快速恢复EDB数据、手动扩盘、历史行情服务降级等。机房也将EDB进程纳入Zabbix监控，以便能及时处理EDB崩溃故障。
</p>

<p>
EDB作为行情系统的核心中间件，在稳定性和性能两方面表现不尽如人意，且技术资料少，技术支持不及时。建议在今后的IT系统建设时，对重要业务使用的组件，以及核心组件，选择有一定质量保证的产品，如市场认可的商业产品、主流开源软件或稳定可靠的自主开发组件等。
</p>

<p>
2、系统升级时间紧张，升级周期长。
</p>

<p>
伊诺系统设计存在缺陷，致使升级时间紧张。伊诺系统有两个系统单点，外TC和LuaServer。外TC只负责消息传递，运行平稳，很少需要变更。但LuaServer不同，LuaServer中集成了大量业务逻辑，当业务需求发生变更，或者需要支持新业务时，必须对LuaServer执行变更操作。LuaServer作为系统单点，一旦出现故障，手机金太阳上的全部业务都会受到影响。因此升级工作往往要到收盘后进行。金太阳这类面向个人的应用软件，需求变更频繁，常常一天有多个升级。在缺乏有效工具的情况下，两个小时内要完成几十台服务器的多个升级和验证工作，时间捉襟见肘。经常出现升级排队的情况。
</p>

<p>
建议在新架构的设计中，兼顾运维、运营等工作的特点和需要，充分和相关团队沟通，找到可以在盘中平滑升级、扩容的方案，缩短升级周期，提高部署效率。
</p>

<p>
3、测试环境行情系统不稳定，需要大量时间维护。
</p>

<p>
行情系统不稳定主要有3个。第一，EDB不稳定，前面已经提过。第二，行情扫描不稳定。由于测试需要，经常要对行情扫描进行重启。有时行情扫描会出现严重异常，导致操作系统重启和EDB崩溃，恢复起来比较麻烦。第三，LuaServer单点问题。金太阳首页会循环发送行情请求。如果LuaServer出现故障或者重启，看起来就像是行情系统异常。所以很多时候收到的测试环境行情问题反馈，都是LuaServer的问题。
</p>

<p>
为了提高测试环境行情服务的稳定性，保障金太阳4.0测试和开发工作，我已经申请了两台服务器专门给4.0使用，正在部署中。
</p>

<p>
4、策划文档过于简略。
</p>

<p>
行情细节比较多，但是策划文档太简略。所以很多时候测试组不以策划文档为测试依据，因为太简略了，很多业务细节覆盖不到。
</p>

<p>
三、下一步工作计划
</p>

<p>
1、行情系统调研和设计。
</p>

<p>
已经对伊诺、通达信、鑫投顾和凌志行情系统进行了调研，完成了行情系统初步设计，编写了方案草稿。稍后会细化方案并评审。
</p>

<p>
2、继续编写行情维护手册和维护工具。
</p>

<p>
为提高行情系统稳定性，正在编写行情手册。已经将草稿发给机房的同事。接下来会继续编写和修订手册，并提供维护工具给运维人员。
</p>

<p>
3、尝试以容器化改造现有行情服务，提高测试环境行情服务稳定性。
</p>

<p>
已经完成了HQServer、EDB和TC的容器化改造，正在对LuaServer进行容器化改造。计划完成后在金太阳4.0的测试环境中部署。
</p>

<p>
四、思考
</p>

<ol class="org-ol">
<li>面向个人用户的IT系统技术选型</li>
</ol>

<p>
IT系统建设最复杂的地方是对异常事件的处理。要让异常事件对业务的影响降到最低，主要有两种思路，一是降低异常事件的发生概率；二是降低单个异常事件对系统和业务的影响范围。如果以第一种思路为主，为了保证对应用软件和运维的质量要求，其应用软件的开发周期、测试周期，以及运维人员的培训周期必然很长。而面向个人用户的IT系统往往需求变更频繁，所以这类系统通常采用第二种思路，主要方法是消除单点和业务隔离。消除单点可以避免在单一模块出现异常时，业务大范围中断。实现消除单点的手段有分布式、集群化等。业务隔离可以保证没有逻辑关系的业务A和B，当业务A出现异常时，业务B不受影响。实现业务隔离的手段有进程隔离、服务器隔离、机房隔离、网络隔离等。
</p>

<p>
业务隔离不仅仅在后台系统架构层面，在通信协议设计上也要注意。比如采用阻塞式的通信方式，如果一个请求超时，后续的请求都会被阻塞。如果一个页面上提供了两种业务，业务A的请求超时，业务B会因为请求被阻塞而不可用。
</p>

<p>
2、组装型产品的质量保证
</p>

<p>
很多项目采用合作开发方式进行。对于这种系统，要保证系统质量，首先要保证采购部分不要成为短板。否则整体质量难以把控。
</p>

<p>
3、面向个人投资者的资本中介业务
</p>

<p>
可以考虑在金太阳中增加风险管理类功能，以提升对提供两融、收益互换等业务的支持。
</p>

<p>
4、目标用户群划分
</p>

<p>
传统上将用户按资产或净资产分类，也有一些将用户按照年龄分类。资产和年龄反映了投资者的风险承受能力，但是无法反映投资者的风险偏好和投资能力。建议在合规范围内，对用户账户余额和历史委托记录数据脱敏后进行聚类分析，将用户按照投资收益分类。把用户看作是基金经理进行评级，对评级高的用户，推荐两融和收益互换。对评级低的用户，加强适当性管理，推荐理财产品。
</p>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2019-09-23 周一 21:13</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
