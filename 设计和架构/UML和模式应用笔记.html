<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-09-23 周一 21:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UML和模式应用笔记</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">UML和模式应用笔记</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org62e5326">第一章 面向对象分析和设计</a></li>
<li><a href="#org5dde0e7">第二章 迭代、进化和敏捷</a></li>
<li><a href="#org2eda5f4">第三章 案例研究</a></li>
<li><a href="#org677a0f6">第四章 初始不是需求阶段</a></li>
<li><a href="#orgdc1aee3">第五章 进化式需求</a></li>
<li><a href="#org18888f7">第六章 用例</a></li>
</ul>
</div>
</div>

<div id="outline-container-org62e5326" class="outline-2">
<h2 id="org62e5326">第一章 面向对象分析和设计</h2>
<div class="outline-text-2" id="text-org62e5326">
<p>
分析（analysis）是对问题和需求的调查研究。更多是从使用者的视角出发，建立一个问题模型或者业务模型。设计（design）是构建一个满足需求的概念上的解决方案，是一个抽象的方案，从逻辑上解决问题。面向对象分析（object-oriented analysis）是使用面向对象这一工具对问题进行调查研究。在分析阶段，“对象”指的是业务领域内的概念。因此面向对象分析的目的就是发现和描述业务领域内的概念（领域对象）。在面向对象设计（object-oriented design）中，“对象”的含义稍有不同。面向对象设计将业务领域内的概念映射为可实现（编码）的软件对象。因此在设计阶段，“对象”往往指软件对象，即模块、组件、类、实例等。设计工作需要在分析工作的基础上进行。由于逻辑上的关联性，在实际工作中这两类工作往往由同一个人或同一个团队完成。因此这两类工作通常放在一起，简称为OOA/D。面向对象分析的工作内容主要有两类：编写用例和建立领域模型。面向对象设计工作有：分配软件对象职责、确定软件对象协作方式和详细设计软件类。下面我们借助一个简短的示例，介绍OOA/D的内容。
</p>

<p>
这个示例是一个简单的骰子游戏。玩家掷2个骰子，如果总点数为7则玩家获得胜利，否则输掉游戏。我们先从定义用例开始。用例（use case）是用户使用系统（或解决方案）的场景和情节。
</p>

<p>
用例1：玩家请求掷骰子。系统展示结果。如果总点数是7则玩家胜，否则玩家输。
</p>

<p>
用例展示了我们要解决的问题。为了解决问题，我们需要了解问题的结构，提取问题中的概念和联系，抽象成领域模型（domain model）。在我们的示例中，领域内有3个概念：玩家、骰子和游戏。玩家有名字属性，和玩游戏、掷骰子两个行为。骰子有点数属性。游戏包含一个玩家和2个骰子。
</p>

<p>
理清了问题结构，我们需要把领域概念映射为逻辑上的软件对象，并为软件对象分配职责和协作关系。
</p>

<p>
玩家 玩游戏
游戏 掷骰子1
游戏 获得骰子1点数
游戏 掷骰子1  
游戏 获得骰子2点数
游戏 判断并展示结果
</p>

<p>
这里的模型和领域模型稍有不同。在领域模型中，“掷骰子”行为是“玩家”所拥有的。在设计阶段必须考虑方案的实施（编码），因此不会完全模拟现实世界，会对分析阶段得到的领域模型做一些调整。
</p>

<p>
为软件对象分配了职责和协作关系后，可以做更细致的设计。
</p>

<p>
类：DiceGame
属性：die1 类型：Die
属性：die2 类型：Die
行为：play()
</p>

<p>
类：Die
属性：faceValue 类型：int
行为：getFaceValue(): int
行为：roll()
</p>

<p>
分析和设计工作的产出物可以使用任何形式来展示。业内通行的做法是将分析阶段的产物使用UML来表达。UML具有应用广泛、形象、可以提供多层次视角等优点。
</p>
</div>
</div>

<div id="outline-container-org5dde0e7" class="outline-2">
<h2 id="org5dde0e7">第二章 迭代、进化和敏捷</h2>
<div class="outline-text-2" id="text-org5dde0e7">
<p>
很多研究表明，尽早对代码进行测试，可以有效提高代码质量，降低开发成本。验证一段代码是否满足设计是容易的。而设计作为概念上的解决方案，是否真正解决了用户面临的问题？很多新的研究证实，尽早验证设计的有效性，对提高软件项目成功率，降低开发成本，同样有着巨大提升作用。基于这个结论，诞生了很多新的软件开发过程，如敏捷开发、极限编程、Scrum等。这些方法常常和迭代式开发（iterative development）实践结合在一起。在迭代开发过程中，开发活动被组织为一系列小项目，每个项目都是在前一个项目基础上，产生一个经过测试和集成的可执行系统。在每个小项目中，通过一系列分析、设计、编码、测试、集成和演示的过程，产生作为整体解决方案的一部分的（子）系统。随着项目不断迭代，产出的系统越来越接近完整的解决方案。乍一看迭代式开发不过将大瀑布分成几个小瀑布。产生这种想法是由于我们还没有介绍迭代开发中最重要的一个概念：时间定量（timeboxed）。时间定量要求每个小项目的周期是固定的一小段时间。通常选择3到4周作为一个小项目周期。由于总的时间是固定的，而编码、测试、集成和演示都需要时间，这就迫使团队将目光聚焦在最重要的需求上。而什么需求才是最重要的？在迭代开始时，产品设计人员和架构师为需求分配优先级。在迭代周期结束时的客户展示阶段，可以验证需求优先级分配是否符合客户的实际期望。通常高优先级的需求具有以下3种特性：具有重要的架构意义（核心架构）、具有高业务价值、具有高风险（性能、极端情况）。由于每个项目周期都要进行需求分析，没有必要在一开始就把全部需求细节都确定下来。每个迭代周期可以选择10%的高阶用例进行细化和开发。高阶用例简单的说就是用一句话描述的用例。在细化阶段，高阶用例
被扩展成详细的用例文档，用以指导编码。
</p>
</div>
</div>

<div id="outline-container-org2eda5f4" class="outline-2">
<h2 id="org2eda5f4">第三章 案例研究</h2>
</div>


<div id="outline-container-org677a0f6" class="outline-2">
<h2 id="org677a0f6">第四章 初始不是需求阶段</h2>
<div class="outline-text-2" id="text-org677a0f6">
<p>
初始阶段必须解决的问题是：涉众是否就项目设想基本达成一致？项目是否值得继续认真研究？初始阶段的工作内容就是遇见项目的范围、设想和业务案例。
</p>

<p>
建模的最大价值是增强理解，而不是记录细节。
</p>
</div>
</div>

<div id="outline-container-orgdc1aee3" class="outline-2">
<h2 id="orgdc1aee3">第五章 进化式需求</h2>
<div class="outline-text-2" id="text-orgdc1aee3">
<p>
需求可以按照FURPS+进行分类：
</p>

<p>
Functional 功能性。特性、功能、安全性。
Usability 可用性。人性化因素、帮助、文档。
Reliablity 可靠性。故障频率、可恢复性、可预测性。
Performance 性能。响应时间、吞吐量、准确性、有效性、资源利用率。
Supportability 可支持性。适应性、可维护性、国际化、可配置性。
</p>

<p>
\+表示辅助性和次要因素，如：
</p>

<p>
Implementation 实现。资源限制、语言和工具、硬件等。
Interface 接口。加强于外部系统接口之上的约束。
Operation 操作。对其操作设置的系统管理。
Packaging 包装。例如物理的包装盒。
Legal 授权。许可证或其他方式。
</p>
</div>
</div>

<div id="outline-container-org18888f7" class="outline-2">
<h2 id="org18888f7">第六章 用例</h2>
<div class="outline-text-2" id="text-org18888f7">
<p>
用例是文本形式的情节描述。用例包含参与者和场景。参与者（actor）是具有行为的人或其他系统（比如时钟）。场景（scenario）是参与者和系统（System under Discussion，SuD）之间的一系列特定的活动和交互，也叫做用例实例（use case instance）。用例（use case）就是一组相关的成功和失败场景集合。参与者分为3类：主要参与者（primary actor）、协助参与者（supporting actor）和幕后参与者（offstage actor）。主要参与者是驱动用例的用户目标，是使用SuD完成服务的对象。对于收银系统，收银员就是主要参与者。协助参与者为SuD提供服务。协助参与者通常是外部计算机系统。幕后参与者在用例中具有影响或利益，但不是协助参与者。比如收银系统中，税务部门就是幕后参与者。
</p>

<p>
Alistair Cockburn提供了一个用例模板
</p>

<p>
部分                 注释
<code>==================</code> <code>=======================================</code>
用例名称             以动词开头
范围                 要设计的系统
级别                 “用户目标”或“子功能”
主要参与者           调用系统，使之交付服务
涉众及其关注点       关注该用例的人，及其需要
前置条件             值得告诉读者的，开始前必须为真的条件
成功保证             值得告知读者的，成功完成必须满足的条件
主成功场景           典型的、无条件的、理想方式的成功场景
扩展                 成功或失败的替代场景
特殊需求             相关的非功能性需求
技术和数据变元表     不同的I/O方法和数据格式
发生频率             影响对实现的调查、测试和时间安排
杂项                 例如未决问题
</p>

<p>
下面是一个用例示例：
</p>

<p>
用例UC1：处理销售。
范围：NextGen POS应用。
级别：用户目标。
主要参与者：收银员。
涉众及其关注点：
1 收银员：希望能够准确、快速地输入，而且没有支付错误。
2 售货员：希望自动更新销售提成。
3 顾客：希望以最小代价完成购买活动并得到快速服务。希望便捷、清晰地看到所输入的商品项目和价格。希望得到购买凭证，以便退货。
4 公司：希望准确地记录交易，满足顾客需求。希望确保记录了支付授权服务的支付票据。希望有一定的容错性，即使在某些服务器构件不可用时（如远程信用卡验证）也能够完成销售。希望能够自动、快速地更新账务和库存信息。
5 经理：希望能够快速执行超控操作，并易于更正收银员的不当操作。
6 政府税收代理：希望能从每笔交易中抽取税金。可能存在多级税务代理，比如国家级、州级和县级。
7 支付授权服务：希望接收到协议和格式正确的数字授权请求。希望准确计算对商店的应付款。
前置条件：收银员必须经过确认和认证。
成功保证（或后置条件）：存储销售信息。准确计算税金。更新账务和库存信息。记录提成。生成票据。记录支付授权的批准。
主成功场景（或基本流程）：
1 顾客携带所购商品或服务到收银台通过POS机付款。
2 收银员开始一次新的销售交易。
3 收银员输入商品条码。
4 系统逐条记录出售的商品，并显示该商品的描述、价格和累计额。价格通过一组价格规则计算。
收银员重复3-4步，直到输入结束。
5 系统显示总额和所计算的税金。
6 收银员告知顾客总额，并请顾客付款。
7 顾客付款，系统处理支付。
8 系统记录完整的销售信息，并将销售和支付信息发送到外部的账务系统（进行账务处理和提成）和库存系统（更新库存）。
9 系统打印票据。
10 顾客携带商品和票据离开（如果有）。
扩展（或替代流程）：
*a 经理在任意时刻要求进行超控操作：
  1 系统进入经理授权模式。
  2 经理或收银员执行某一经理模式的操作。例如，变更现金结余，恢复其他登录者中断的销售交易，取消销售交易等。
  3 系统恢复到收银员授权模式。
*b 系统在任意时刻失败：
  为了支持恢复和更正账务处理，要保证所有交易的敏感状态和时间都能够从场景的任何一步中完全恢复。
  1 收银员重启系统，登录，请求恢复上次状态。
  2 系统重建上次状态。
    2a 系统在恢复过程中检测到异常。
      1 系统向收银员提示错误，记录此错误，并进入一个初始状态。
      2 收银员开始一次新的销售交易。
1a 客户或经理需要恢复一个中断的销售交易。
  1 收银员执行恢复操作，并且输入ID以提取对应的销售交易。
  2 系统显示被恢复的销售交易状态及其小计。
    2a 未发现对应的销售交易。
      1 系统向收银员提示错误。
      2 收银员可能会开始一个新的销售交易，并重新输入所有商品。
  3 收银员继续该次销售交易（可能要输入更多的商品或处理支付）。
2-4a 顾客告诉收银员其免税状态（例如：年长者，本国人等）。
  1 收银员进行核实，并输入免税状态代码。
  2 系统记录该状态编码（在计算税金时使用）。
3a 无效商品ID（在系统中未发现）：
  1 系统提示错误并拒绝输入该ID。
  2 收银员响应该错误。
    2a 商品ID可读（例如，数字型的UPC（通用产品代码））：
      1 收银员手动输入商品ID。
      2 系统显示商品项目的描述和价格。
        2a 无效商品ID：系统提示错误。收银员尝试其他方式。
    2b 系统内不存在该商品ID，但是商品附有价签。
      1 收银员请求经理执行超控操作。
      2 经理执行响应的超控操作。
      3 收银员选择手工输入价格，输入价签上的价格，并且请求对该价目进行标准计税。（因为没有产品信息，计税引擎无法确定如何计税。）
    2c 收银员通过执行寻找产品帮助以获取正确的商品ID及其价格。
    2d 另外，收银员可以向其他员工询问商品ID或价格，然后手工输入ID或价格（参见以上内容）。
3b 当有多个商品项目属于同一类别的时候（如5个汉堡），不必记录每个商品项目的唯一标识：
  1 收银员可以输入类别的标识和商品的数量。
3c 需要手工输入类别和价格（例如，花卉或纸牌及其价格）：
  1 收银员手工输入特定的类别代码及其价格。
3-6a 顾客要求收银员从所购商品中去掉一项：
  所去除商品的价格必须小于收银员的权限，否则需要经理执行超控操作。
  1 收银员输入商品ID并将其删除。
  2 系统删除该项目并显示更新后的累计额。
    2a 商品价格超过了收银员权限：
      1 系统提示错误，并建立经理超控。
      2 收银员请求经理超控，完成超控后，重做该操作。
3-6b 顾客要求收银员取消销售交易。
  1 收银员在系统中取消销售交易。
3-6c 收银员延迟销售交易。
  1 系统记录销售交易信息，使其能够在任何POS登录中恢复操作。
  2 系统显示用来恢复销售交易的“延迟票据”，其中包含商品项目和销售交易ID。
4a 系统定义的商品价格不是顾客预期的价格（顾客对此产生抱怨并要求减价）：
  1 收银员请求经理批准。
  2 经理执行超控操作。
  3 收银员手工输入超控后的价格。
  4 系统显示新价格。
5a 系统检测到与外部税务计算系统服务的通信故障：
  1 系统在POS机节点上重启此服务，并继续操作。
    1a 系统检测到该服务无法重启
      1 系统提示错误。
      2 收银员手动计算和输入税金，或者取消该销售交易。
5b 顾客声称他们符合打折条件（例如，是雇员或重要顾客）
5c 顾客要求兑现账户积分，用于此次销售交易：
  1 收银员提交积分请求。
  2 收银员输入顾客ID。
  3 系统应用积分直到价格为0，同时扣除结余积分。
6a 顾客要求现金付款，但所携现金不足：
  1 顾客要求使用其他支付方式。
    1a 顾客要求取消此次销售交易，收银员在系统上取消该交易。
7a 现金支付。
  1 收银员输入收取的现金额。
  2 系统显示找零余额，并弹出现金抽屉。
  3 收银员放入收取的现金，并给顾客找零。
  4 系统记录该现金支付。
7b 信用卡支付：
  1 顾客输入信用卡账户信息。
  2 系统显示其支付信息以备验证。
  3 收银员确认。
    3a 收银员取消付款步骤。
      1 系统回复到“商品输入”模式。
  4 系统向外部支付授权服务系统发送支付授权请求，并请求批准该支付。
    4a 系统检测到与外部系统协作是故障。
      1 系统向收银员提示错误。
      2 收银员请求顾客更换支付方式。
  5 系统收到批准支付的应答并提示收银员，同时弹出现金抽屉（以便放入签名后的信用卡支付票据）。
    5a 系统收到拒绝支付的应答
      1 系统向收银员提示支付被拒绝。
      2 收银员请求顾客更换支付方式。
    5b 应答超时。
      1 系统向收银员提示支付被拒绝。
      2 收银员请求顾客更换支付方式。
  6 系统记录信用卡支付信息，其中包括支付批准。
  7 系统显示信用卡支付的签名输入机制。
  8 收银员请求顾客签署信用卡支付。顾客输入签名。
  9 如果在纸质票据上签名，则收银员将该票据放入现金抽屉并关闭抽屉。
7c 支票支付&#x2026;
7d 记账支付&#x2026;
7e 收银员取消支付步骤：
  1 系统回到“商品输入”模式。
7f 顾客出示优惠券：
  1 在处理支付之前，收银员记录每张优惠券，系统扣除相应金额。系统记录已使用的优惠券以备账务处理只用。
    1a 输入的优惠券不适用于所购商品。
      1 系统向收银员提示错误。
9a 存在产品回扣。
  1 系统对每个具有回扣的商品给出回扣表单和票据。
9b 股票索要赠品票据（不显示价格）。
  1 收银员请求赠品票据，系统给出赠品票据。
9c 打印票据。
  1 如果系统能够检测到错误，给出提示。
  2 收银员更换纸张。
  3 收银员请求打印其他票据。
特殊需求：
</p>
<ul class="org-ul">
<li>使用大尺寸平面显示触摸屏UI。文本信息可见距离为1米。</li>
<li>90%的信用卡授权响应时间小于30秒。</li>
<li>由于某些原因，我们希望在访问远程服务（如库存系统）失败的情况下具有比较强的恢复功能。</li>
<li>支持文本显示的语言国际化。</li>
<li>在步骤3和步骤7之间能够加入可插拔的业务规则。</li>
</ul>
<p>
&#x2026;
技术与数据变元表：
*a 经理超控需要刷卡（由读卡器读取超控卡）或在键盘上输入授权码。
3a 商品ID可以用条码扫描器（如果有条形码）或键盘输入。
3b 商品ID可以使用UPC（通用产品代码）、EAN（欧洲物品编码）、JAN（日本物品编码）或SKU（库存信息）等任何一种编码方式。
7a 信用卡账户信息可以用读卡器或键盘输入。
7b 记录在纸质票据上的信用卡支付签名。但我们预测，两年内会有许多顾客将希望使用数字签名。
发生频率：可能会不断地发生。
未决问题：
</p>
<ul class="org-ul">
<li>税法如何变化？</li>
<li>研究远程服务的恢复问题。</li>
<li>针对不同的业务需要怎样进行定制。</li>
<li>收银员是否必须从系统注销后带走他们的现金抽屉。</li>
<li>顾客是否可以直接使用读卡器，还是必须由收银员完成？</li>
</ul>

<p>
在这个模板中，范围界定了要设计的系统。如果用例针对一个软件系统的使用，就叫做系统用例（system use case）。如果描述了顾客和相关人员如何使用业务，叫做业务用例（business use case）。业务用例规模更大。类似的，级别分为用户目标级别（user-goal level）和子功能级别（subfunction-level）。
</p>

<p>
要注意的是，在主成功场景（基本流程）中只能记录一个理想路径。其他的分支和扩展放到扩展部分说明。场景记录以下3中步骤：参与者之间的交互，确认过程，系统完成时的状态变更。
</p>

<p>
编写早期用例的一个重要方法是摒除用户界面，只考虑本质的业务操作意图。在设计子系统时在考虑这些细节。
</p>

<p>
编写用例要使用黑盒风格，如：系统记录销售。反例是：系统将销售记录写入数据库。
</p>

<p>
发现用例的方法：
#. 选择系统边界。系统仅仅是软件应用，还是软硬件结合的整体？是一个人用，还是一个组织在用？
#. 确定主要参与者。哪些人或物通过系统实现了目标？
#. 确定每个主要参与者的目标。
#. 定义满足用户目标的用例。
</p>

<p>
有助于发现主要参与者和目标的问题：
#. 谁来启动和停止系统？
#. 谁来完成用户管理和安全管理？
#. 谁来完成系统管理？
#. “时间”是参与者吗？系统是否需要响应时间事件来完成某些活动？
#. 当系统失败时，是否存在监控进程将系统重启？
#. 软件升级是如何处理的？采用“推”模式还是“拉”模式？
#. 除了人作为主要参与者之外，还有其他外部的软件或者自动机器系统调用了该系统的服务吗？
#. 谁来考察系统活动或性能？
#. 谁来考察日志？是否可以远程检索？
#. 系统发生错误或故障时应通知谁？
</p>

<p>
建立领域模型的方法：
#. 寻找概念类。
#. 绘制UML类图。
#. 添加关联和属性。
</p>

<p>
寻找概念类的方法：
#. 重用和修改现有模型。
#. 使用分类列表。
#. 确定名词短语。
</p>

<p>
概念类和属性的区分方法是：如果某个概念类不是现实世界中的数字或文本，这就是一个概念类，不是属性。
</p>

<p>
如果两个领域对象在一段时间内是联系在一起的，则两个概念类存在关联。
领域模型的属性应该只是简单的数字、文本等类型，不应包含其他领域模型。要表示两个领域模型的关联，要使用关系，而不是属性。在领域模型中，任何属性都不能表示外键。
</p>

<p>
在领域模型中，是否为一些数据类型（如字符串）建立领域模型呢？如果满足下列中的某一点，需要这样做：
</p>

<p>
#. 由不同的小节组成。如400-800-1234。
#. 支持解析和校验。如身份证号码。
#. 具有其他属性，如日期。
</p>

<p>
创建者（Creator）模式：
问题：谁创建了类A实例？
方案：如果满足下列条件之一，创建类A实例的职责应当分配给类B：
#. B包含A或组成A的聚集。
#. B记录A。
#. B紧密使用A。
#. B具有A的初始化数据。
优点：支持低耦合。
相关模式：抽象工厂、工厂
</p>

<p>
信息专家（Information Export）模式
问题：为对象分配职责的基本原则是什么？
方案：把职责分配给具有完成该职责所需信息的类，这个类叫做信息专家。
优点：维持信息的封装性，支持低耦合。
</p>

<p>
低耦合（Low Coupling）模式
问题：如何减少因变化产生的影响？
方案：分配职责以使耦合保持在较低的水平。
优点：不受其他构件变化的影响。易于单独理解。便于复用。
</p>

<p>
耦合是元素和其他元素连接、感知和依赖程度的度量。高耦合导致的问题：相关类的变化导致本体被迫变化。难以单独理解。使用类时需要它所依赖的类。
</p>

<p>
控制器Controller
在UI层之上首先接收和协调（控制）系统操作的对象是什么？
方案：
</p>
<ol class="org-ol">
<li>代表系统、根对象、运行软件的设备或主要的子系统。</li>
<li>代表发生操作的用例场景。</li>
</ol>
<p>
优点：增加了可复用和接口可插拔的潜力。获得了推测用例状态的机会。
相关模式：命令Command 外观Facade 层Layer（POSA模式）纯虚构。
</p>

<p>
控制器要把任务委派出去。如果控制器处理了太多的事件和任务，要么拆分成多个控制器，要么做成只分配任务的控制器。
</p>

<p>
高内聚（High Cohesion）
怎样是对象保持有内聚、可理解和可管理，同时具有支持低耦合的附加作用？
方案：职责分配应当保持高内聚。
</p>

<p>
内聚是软件元素操作在功能上的相关程度。
</p>

<p>
GRASP是通用职责分配软件模式（General Responsibility Assignment Software Patterns）。GRASP的9个模式为：
创建者Creator 控制器Controller 纯虚构Pure Fabrication 信息专家Information Expert 高内聚High Cohesion 间接性 Indirection 低耦合 Low Coupling 多态性Polymorphism 防止变异 Protected Variations
</p>

<p>
命令-查询分离原则（Command-Query Separation Principle）执行动作（修改对象状态）和查询数据（幂等）的操作要分离。否则会违反最小意外原则（Least Surprise）。
</p>

<p>
可见性（visibility）是一个对象引用其他对象的能力。可见性可以分为4个层面：
</p>

<p>
属性可见性：B是A的属性。
参数可见性：B是A中方法的参数。
局部可见性：B是A中方法的局部对象。
全局可见性：B是某种全局对象。
</p>

<p>
多态Polymorphism
如何处理基于类型的选择？如何创建可插拔的软件构建？
方案：使用多态。不要测试对象类型，不要用逻辑条件执行基于类型的不同选择。
优点：易于增加新变化所需的扩展。不需要影响客户端就能引入新实现。
涉及的模式：适配器adapter、命令command、组合composite、代理proxy、状态state、策略strategy。
</p>

<p>
纯虚构Pure fabrication
为了分配职责而定义的没有概念类对应的软件类。
优点：高内聚、低耦合
涉及模式：适配器Adapter、命令Command、策略Strategy。
</p>

<p>
间接性indirection
为了避免两个对象之间的直接耦合。
将职责分配给中介对象。
相关模式：适配器adapter、桥bridge、外观facade、观察者observer、中介mediator。
</p>


<p>
活动图用户可视化业务流程。
</p>

<p>
将领域模型划分为包结构时，将满足下列条件的元素放到一起：
</p>
<ul class="org-ul">
<li>在同一个主题领域，概念或目标密切相关的元素。</li>
<li>在同一个类层次结构中的关系。</li>
<li>参与同一个用例的元素。</li>
<li>有很强的关联性的元素。</li>
</ul>

<p>
软件系统中有两种地方需要特别关注：变化点（variation point）是现有系统或需求中的变化之处，如必须支持多个税金计算器接口。进化点（evolution point）是现有需求中不存在的，但可能在将来发生的变化点。
</p>

<p>
架构分析是指在功能性需求的语境中识别和解决非功能性需求。
</p>

<p>
缺陷Fault：异常行为的起因。
错误Error：缺陷在运行系统中的表现。
故障Failure：由错误引起的服务拒绝。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2019-09-23 周一 21:13</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
